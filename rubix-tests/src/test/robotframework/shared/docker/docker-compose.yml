version: '3.7'
services:
  rubix-master:
    build:
      context: .
      args:
        is_master: "true"
    volumes:
      - type: bind
        source: ${DATADIR} # Environment variable set at start of Compose command execution
        target: /tmp/data
    ports:
      - "8900:8899"  # BookKeeperServer
      - "8800:8898"  # LocalDataTransferServer
    networks:
      rubix-cluster:
        ipv4_address: 172.18.8.0
  rubix-worker-1:
    depends_on:
      - rubix-master
    build:
      context: .
      args:
        is_master: "false"
    volumes:
      - type: bind
        source: ${DATADIR} # Environment variable set at start of Compose command execution
        target: /tmp/data
    ports:
      - "8901:8899"  # BookKeeperServer
      - "8801:8898"  # LocalDataTransferServer
      - "8123:8123"  # ContainerRequestServer
      - "1901:1099"  # rmiregistry
    networks: 
      rubix-cluster:
        ipv4_address: 172.18.8.1
  rubix-worker-2:
    depends_on:
      - rubix-master
    build:
      context: .
      args:
        is_master: "false"
    volumes:
      - type: bind
        source: ${DATADIR} # Environment variable set at start of Compose command execution
        target: /tmp/data
    ports:
      - "8902:8899"  # BookKeeperServer
      - "8802:8898"  # LocalDataTransferServer
#      - "8123:8123"  # ContainerRequestServer
#      - "1902:1099"  # rmiregistry
    networks:
      rubix-cluster:
        ipv4_address: 172.18.8.2

networks:
  rubix-cluster:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.18.0.0/16
